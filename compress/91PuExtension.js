var table={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},sequences={"#":"C C# D D# E F F# G G# A A# B".split(" "),b:"C Db D Eb E F Gb G Ab A Bb B".split(" ")},set_box_context={originNode:null,prevNode:null,curNode:null};const chordRegex=/(.+)[/](.+)/;function Adblock(){let e=/(adGeek).*/,t=/(div-gpt-ad).*/,o=/(CFOutDiv)/;document.querySelectorAll("#coverDiv").forEach(e=>{e.remove("")}),document.querySelectorAll("#viptoneWindow").forEach(e=>{e.remove("")}),document.querySelectorAll(".alertwin").forEach(e=>{e.remove("")}),document.querySelectorAll("div[id]").forEach(t=>{t.id.match(e)&&t.remove("")}),document.querySelectorAll("div[id]").forEach(e=>{e.id.match(t)&&e.remove("")}),document.querySelectorAll("div[id]").forEach(e=>{e.id.match(o)&&e.remove("")}),document.querySelectorAll("ins").forEach(e=>{e.remove("")}),document.querySelectorAll(".set").forEach(e=>{var t=document.createElement("div");t.setAttribute("class","set"),t.innerHTML=e.innerHTML,e.parentElement.appendChild(t),e.remove("")})}var calculDistance=(e,t)=>(e=table[e],(t=table[t])-e),mappingChord=(e,t,o)=>{var r,n=e.match("([A-Z]([#|b]?))(.*)");n.splice(0,1);var c=0;o<0?(c=table[n[0]],r=sequences.b):(c=table[n[0]],r=sequences["#"]),c=c+t+12,c%=12,n[0]=r[c];var i=n[0].split("");return 2===i.length&&(n[0]=i[0]+"<sup>"+i[1]+"</sup>"),3===n.length?n[0]+=n[2]:2===n.length&&(n[0]+=n[1]),n[0]},proccessChord=(e,t,o)=>{var r,n=e.innerText.match(chordRegex);if(n){n.splice(0,1);var c=mappingChord(n[0],t,o),i=mappingChord(n[1],t,o);return c+"/"+i}return mappingChord(e.innerText,t,o)},updateChordUI=(e,t,o)=>{var r=proccessChord(e,t,o);e.innerHTML=r},cacheTfs=null,keyTransposition=e=>{var t=calculDistance(set_box_context.curNode.innerText,e.innerText),o=calculDistance(set_box_context.originNode.innerText,e.innerText);console.log("origin Dist :"+o),console.log(t),null===cacheTfs&&(cacheTfs=document.querySelectorAll(".tf")),cacheTfs.forEach(e=>{updateChordUI(e,t,o)})};function updateBtnUI(e){set_box_context.curNode.classList.remove("select"),e.classList.add("select")}function onClickKey(e){updateBtnUI(e.target),keyTransposition(e.target),set_box_context.prevNode=set_box_context.curNode,set_box_context.curNode=e.target}function CostomKeyTranspositionInit(){document.querySelectorAll("div.ks").forEach(e=>{for(var t of e.children)t.getAttribute("class")&&(set_box_context.originNode=t),t.addEventListener("click",onClickKey);set_box_context.prevNode=set_box_context.originNode,set_box_context.curNode=set_box_context.originNode,console.log(set_box_context.originNode)})}Adblock(),CostomKeyTranspositionInit(),completion();